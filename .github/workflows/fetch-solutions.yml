name: Update Submodule & Fetch Solutions

on:
  schedule:
    - cron: "20 */4 * * *"
  workflow_dispatch:

jobs:
  update:
    runs-on: self-hosted
    permissions:
      contents: write

    steps:
      - name: Check out repository with submodules
        uses: actions/checkout@v4
        with:
          persist-credentials: false

      - name: Update submodule to latest
        run: |
          git submodule update --init --recursive
          git submodule update --remote --recursive
          git status

      - name: Set up venv; run script; format files
        run: |
          export PATH=$PATH:~/.local/bin
          uv venv
          source .venv/bin/activate
          uv sync
          python move_solutions.py
          ruff format

      - name: Commit and push changes
        run: |
          git add .
          if ! git diff-index --quiet HEAD; then
            git commit -m "Update submodule and move solution files"
            git push
          else
            echo "No changes to commit"
          fi
